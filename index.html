<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A Set of Tools For Solving The Maximal Covering Location Problem • maxcovr</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="A Set of Tools For Solving The Maximal Covering Location Problem">
<meta name="description" content='Solving the "maximal covering location problem" as described by Church can be difficult for users not familiar with linear programming. maxcovr provides functions to make it easy to solve this problem, and tools to calculate facility coverage.'>
<meta property="og:description" content='Solving the "maximal covering location problem" as described by Church can be difficult for users not familiar with linear programming. maxcovr provides functions to make it easy to solve this problem, and tools to calculate facility coverage.'>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">maxcovr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3.9200</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/cross_validation_with_maxcovr.html">Using Cross Validation with maxcovr</a></li>
    <li><a class="dropdown-item" href="articles/intro_to_maxcovr.html">Using maxcovr</a></li>
    <li><a class="dropdown-item" href="articles/using_max_coverage_relocation.html">Using max_coverage_relocation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/njtierney/maxcovr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="maxcovr">maxcovr<a class="anchor" aria-label="anchor" href="#maxcovr"></a>
</h1></div>
<!-- badges: start -->

<p>maxcovr was created to make it easy for a non expert to correctly solve the maximum covering location problem described by <a href="http://www.geog.ucsb.edu/~forest/G294download/MAX_COVER_RLC_CSR.pdf" class="external-link">Church</a>. Implementations of this problem (such as <a href="https://www.resuscitationjournal.com/article/S0300-9572(18)30065-0/fulltext" class="external-link">optimimum AED placement</a>) may use commercial software such as AMPL, Gurobi, or CPLEX, which require an expensive license, or use open source licenses but not provide source code to the analysis performed (e.g., <a href="http://www.sciencedirect.com/science/article/pii/S0360835215003927" class="external-link">Bonnet 2014</a>) This builds a substantial barrier to implement and reproduce these analyses.</p>
<p>maxcovr was created to make results easy to implement, reproduce, and extend by using:</p>
<ul>
<li>R, a free and open source language</li>
<li>Open source solvers, glpk and lpSolve, that can be used on Linux, Windows, and OSX.</li>
<li>Real-world, open source example data.</li>
<li>Tidyverse principles to make it easy to use and reason with.</li>
</ul>
<p>Please note that this project is released with a <a href="CONDUCT.html">Contributor Code of Conduct</a>. By participating in this project you agree to abide by its terms.</p>
</div>
<div class="section level1">
<h1 id="how-to-install">How to Install<a class="anchor" aria-label="anchor" href="#how-to-install"></a>
</h1>
<p>Install the development version of <code>maxcovr</code> from <a href="http://njtierney.r-universe.dev/" class="external-link">r-universe</a>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"maxcovr"</span>, repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"https://njtierney.r-universe.dev"</span>, <span class="st">"https://cloud.r-project.org"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>(Note - installing from r-universe is just like installing from CRAN, and should be faster and more convenient than installing from GitHub)</p>
<p>Or install using <code>remotes</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"njtierney/maxcovr"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="using-maxcovr">Using maxcovr<a class="anchor" aria-label="anchor" href="#using-maxcovr"></a>
</h1>
<p><em>Disclaimer: The following is a fictitious example using real world data.</em></p>
<p>Consider the toy example where we are playing a tower defense game and we need to place crime surveillance towers to detect crime.</p>
<p>We have two datasets, <code>york</code>, and <code>york_crime</code>:</p>
<ul>
<li>
<code>york</code> contains listed building GPS locations in the city of York, provided by the city of york</li>
<li>
<code>york_crime</code> contains a set of crime data from the <a href="https://www.github.com/njtierney/ukpolice" class="external-link"><code>ukpolice</code> package</a>, containing crime data from September 2016.</li>
</ul>
<p>In this game we already have a few towers built, which are placed on top of the listed buildings with a grade of I. We will call this dataset <code>york_selected</code>, and the remaining building locations <code>york_unselected</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/njtierney/maxcovr" class="external-link">maxcovr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span></span>
<span><span class="co"># subset to be the places with towers built on them.</span></span>
<span><span class="va">york_selected</span> <span class="op">&lt;-</span> <span class="va">york</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">grade</span> <span class="op">==</span> <span class="st">"I"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">york_unselected</span> <span class="op">&lt;-</span> <span class="va">york</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">grade</span> <span class="op">!=</span> <span class="st">"I"</span><span class="op">)</span></span></code></pre></div>
<p>The purpose of the game is to build towers in places so that they are within 100m of crime. We are going to use the crime data that we have to help us choose ideal locations to place towers.</p>
<p>This can be illustrated with the following graphic, where the red circles indicate the current coverage of the building locations, so those blue crimes within the circles are within the coverage.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/" class="external-link">leaflet</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rstudio.github.io/leaflet/reference/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addCircleMarkers</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">york</span>, </span>
<span>                     radius <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                     color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addCircles</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">york_selected</span>, </span>
<span>               radius <span class="op">=</span> <span class="fl">100</span>,</span>
<span>               stroke <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>               fill <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>               opacity <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>               weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>               color <span class="op">=</span> <span class="st">"coral"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/addProviderTiles.html" class="external-link">addProviderTiles</a></span><span class="op">(</span><span class="st">"CartoDB.Positron"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-methods.html" class="external-link">setView</a></span><span class="op">(</span>lng <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">york</span><span class="op">$</span><span class="va">long</span><span class="op">)</span>,</span>
<span>            lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">york</span><span class="op">$</span><span class="va">lat</span><span class="op">)</span>,</span>
<span>            zoom <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="co">#&gt; Assuming "long" and "lat" are longitude and latitude, respectively</span></span>
<span><span class="co">#&gt; Assuming "long" and "lat" are longitude and latitude, respectively</span></span></code></pre></div>
<p><img src="README-figs/leaflet-1.png"><!-- --></p>
<p>Currently the coverage looks alright, but let’s verify the coverage using the <code>nearest</code> function. <code>nearest</code> takes two dataframes and returns the nearest lat/long coords from the first dataframe to the second dataframe, along with the distances between them and the appropriate columns from the building dataframe.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">dat_dist</span> <span class="op">&lt;-</span> <span class="va">york_selected</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/nearest.html">nearest</a></span><span class="op">(</span><span class="va">york_crime</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat_dist</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 22</span></span>
<span><span class="co">#&gt;   to_id nearest_id distance category          persistent_id date  lat_to long_to</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;             &lt;chr&gt;         &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1         66    166.  anti-social-beha… 62299914865f… 2016…   54.0   -1.08</span></span>
<span><span class="co">#&gt; 2     2         48   2087.  anti-social-beha… 4e34f53d247f… 2016…   54.0   -1.12</span></span>
<span><span class="co">#&gt; 3     3         55     68.2 anti-social-beha… 2a0062f3dfac… 2016…   54.0   -1.08</span></span>
<span><span class="co">#&gt; 4     4         11    286.  anti-social-beha… eb53e09ae46a… 2016…   54.0   -1.09</span></span>
<span><span class="co">#&gt; 5     5         25    536.  anti-social-beha… 6139f131b724… 2016…   54.0   -1.08</span></span>
<span><span class="co">#&gt; 6     6         20    160.  anti-social-beha… d8de26d5af47… 2016…   54.0   -1.08</span></span>
<span><span class="co">#&gt; # ℹ 14 more variables: street_id &lt;chr&gt;, street_name &lt;chr&gt;, context &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   id &lt;chr&gt;, location_type &lt;chr&gt;, location_subtype &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   outcome_status &lt;chr&gt;, long_nearest &lt;dbl&gt;, lat_nearest &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   object_id &lt;int&gt;, desig_id &lt;chr&gt;, pref_ref &lt;int&gt;, name &lt;chr&gt;, grade &lt;chr&gt;</span></span></code></pre></div>
<p>You can instead return a dataframe which has every building in the rows, and the nearest crime to the building, by simply changing the order.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">dat_dist_bldg</span> <span class="op">&lt;-</span> <span class="va">york_crime</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/nearest.html">nearest</a></span><span class="op">(</span><span class="va">york_selected</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat_dist_bldg</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 22</span></span>
<span><span class="co">#&gt;   to_id nearest_id distance long_to lat_to object_id desig_id pref_ref name     </span></span>
<span><span class="co">#&gt;   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;int&gt; &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;    </span></span>
<span><span class="co">#&gt; 1     1         33     36.0   -1.09   54.0      6144 DYO1195    463280 GUILDHAL…</span></span>
<span><span class="co">#&gt; 2     2        183     35.8   -1.09   54.0      6142 DYO1373    462942 BOOTHAM …</span></span>
<span><span class="co">#&gt; 3     3        503     95.3   -1.08   54.0      3463 DYO365     464845 THE NORM…</span></span>
<span><span class="co">#&gt; 4     4        273     44.3   -1.08   54.0      3461 DYO583     464427 CHURCH O…</span></span>
<span><span class="co">#&gt; 5     5        908     26.5   -1.08   54.0      3460 DYO916     463764 CUMBERLA…</span></span>
<span><span class="co">#&gt; 6     6        495    326.    -1.13   54.0      3450 DYO1525    328614 CHURCH O…</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: grade &lt;chr&gt;, category &lt;chr&gt;, persistent_id &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   date &lt;chr&gt;, lat_nearest &lt;dbl&gt;, long_nearest &lt;dbl&gt;, street_id &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   street_name &lt;chr&gt;, context &lt;chr&gt;, id &lt;chr&gt;, location_type &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   location_subtype &lt;chr&gt;, outcome_status &lt;chr&gt;</span></span></code></pre></div>
<p>To evaluate the coverage we can use <code>coverage</code>. This reads as find the coverage of the york buildings (below) to the crimes. Coverage of the first thing on the second thing. Or, how many of the second thing are covered by the first thing.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="reference/coverage.html">coverage</a></span><span class="op">(</span><span class="va">york_selected</span>, <span class="va">york_crime</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 7</span></span>
<span><span class="co">#&gt;   distance_within n_cov n_not_cov prop_cov prop_not_cov dist_avg dist_sd</span></span>
<span><span class="co">#&gt;             &lt;dbl&gt; &lt;int&gt;     &lt;int&gt;    &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1             100   339      1475    0.187        0.813    1400.   1597.</span></span></code></pre></div>
<p>This tells us that out of all the crime, 18.68% of it is within 100m, 339 crimes are covered, but the mean distance to the surveillance camera is 1400m.</p>
<div class="section level2">
<h2 id="maximising-coverage">Maximising coverage<a class="anchor" aria-label="anchor" href="#maximising-coverage"></a>
</h2>
<p>Say then we want to add another 20 surveillance towers, but we want to use the best 20, we use <code>max_coverage</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span><span class="co"># mc_20 &lt;- max_coverage(A = dat_dist_indic,</span></span>
<span><span class="va">mc_20</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/max_coverage.html">max_coverage</a></span><span class="op">(</span>existing_facility <span class="op">=</span> <span class="va">york_selected</span>,</span>
<span>                      proposed_facility <span class="op">=</span> <span class="va">york_unselected</span>,</span>
<span>                      user <span class="op">=</span> <span class="va">york_crime</span>,</span>
<span>                      n_added <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                      distance_cutoff <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.556   0.032   0.604</span></span></code></pre></div>
<p><code>max_coverage</code> actually returns a dataframe of lists.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mc_20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ------------------------------------------- </span></span>
<span><span class="co">#&gt; Model Fit: maxcovr fixed location model </span></span>
<span><span class="co">#&gt; ------------------------------------------- </span></span>
<span><span class="co">#&gt; model_used:        max_coverage </span></span>
<span><span class="co">#&gt; existing_facility: york_selected </span></span>
<span><span class="co">#&gt; proposed_facility: york_unselected </span></span>
<span><span class="co">#&gt; user:              york_crime </span></span>
<span><span class="co">#&gt; distance_cutoff:   100 </span></span>
<span><span class="co">#&gt; n_added:           20 </span></span>
<span><span class="co">#&gt; d_existing_user:            lpSolve </span></span>
<span><span class="co">#&gt; -------------------------------------------</span></span></code></pre></div>
<p>This is handy because it means that later when you want to explore multiple <code>n_added</code>, say you want to explore how coverage changes for 20, 40, 60, 80, 100 <code>n_added</code>, then these are added as rows in the dataframe, which makes it easier to do summaries and manipulate.</p>
<p>Important features here of this dataframe are:</p>
<ul>
<li>
<code>facility_selected</code>: A dataframe from <code>proposed_facilities</code>, containing the facilities selected by the optimisation.</li>
<li>
<code>user_affected</code>: A dataframe from <code>user</code>, that contains the users that were affected by the new optimised placement</li>
<li>
<code>model_coverage</code>: A dataframe containing summary info on the number of users covered, the percentage of coverage, and the average distance.</li>
<li>
<code>existing_coverage</code>: returns a similar summary dataframe the original coverage, from <code>existing_facilities</code>.</li>
<li>
<code>summary</code>: returns the binded <code>model_coverage</code> and <code>existing_coverage</code>.</li>
<li>
<code>n_added</code>: The number of things added</li>
<li>
<code>distance_cutoff</code>: the distance cutoff selected</li>
</ul>
<p>One can also use <code>map</code> from <code>purrr</code> to fit many different configurations of <code>n_added</code>. (Future work will look into allowing <code>n_added</code> to take a vector of arguments).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="va">n_add_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">40</span>, <span class="fl">60</span>, <span class="fl">80</span>, <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span><span class="va">map_mc_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">n_add_vec</span>,</span>
<span>                       .f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="reference/max_coverage.html">max_coverage</a></span><span class="op">(</span>existing_facility <span class="op">=</span> <span class="va">york_selected</span>,</span>
<span>                                          proposed_facility <span class="op">=</span> <span class="va">york_unselected</span>,</span>
<span>                                          user <span class="op">=</span> <span class="va">york_crime</span>,</span>
<span>                                          distance_cutoff <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                                          n_added <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   1.848   0.085   1.940</span></span></code></pre></div>
<p>This returns a list of dataframes, which we can bind together like so:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">map_cov_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">map_mc_model</span><span class="op">$</span><span class="va">model_coverage</span><span class="op">)</span></span></code></pre></div>
<p>We can then visualise the effect on coverage:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">map_mc_model</span><span class="op">$</span><span class="va">existing_coverage</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>          <span class="va">map_cov_results</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">n_added</span><span class="op">)</span>,</span>
<span>               y <span class="op">=</span> <span class="va">pct_cov</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="README-figs/vis-coverage-1.png"><!-- --></p>
<p>You can read more about the use of <code>max_coverage</code>, covering topics like cross validation in the vignette.</p>
</div>
</div>
<div class="section level1">
<h1 id="known-issues">Known Issues<a class="anchor" aria-label="anchor" href="#known-issues"></a>
</h1>
<ul>
<li><p><code><a href="reference/max_coverage.html">max_coverage()</a></code> may take a bit of time to run, depending on your data size. From initial testing, if the product of the number of rows of the <code>proposed_facilities</code> and <code>users</code> exceeds 100 million, it might take more than 1 minute. Of course, this may depend on the structure / complexity of your data and problem.</p></li>
<li><p>The distances calculated in <code>maxcovr</code> use <a href="https://en.wikipedia.org/wiki/Haversine_formula" class="external-link">haversines formula</a>, which makes the assumption that the earth is a sphere and calculates the greater circle distance. Whilst not wholly correct, haversine is a useful approximation that is reasonable for small scale distances, where the accuracy can be within metres which is what <code>maxcovr</code> was initially built for. In the future <code>maxcovr</code> will use more accurate distance functions provided in <a href="https://github.com/hypertidy/geodist" class="external-link"><code>geodist</code></a>, and give the user control over the distance calculation used (haversines, vincenty, cheap ruler, geodesic, etc).</p></li>
</ul>
</div>
<div class="section level1">
<h1 id="future-work">Future Work<a class="anchor" aria-label="anchor" href="#future-work"></a>
</h1>
<p>I will be focussing on making <code>maxcovr</code> work well within the <code>tidyverse</code>. This includes providing sensible standard summaries using key function verbs from <code>broom</code>, adding exploratory plots, improving speed using Rcpp, and allowing users to select the solver they want to use.</p>
<p>If you have any suggestions, please <a href="http://www.github.com/njtierney/maxcovr/issues/new" class="external-link">file an issue</a> and I will get to it as soon as I can.</p>
</div>
<div class="section level1">
<h1 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h1>
<p>Please note that this project is released with a <a href="CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>.</p>
<p>By participating in this project you agree to abide by its terms.</p>
</div>
<div class="section level1">
<h1 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h1>
<p>Oliver Czibula, for this initial help in helping me understand the Maximum Covering Location Problem. Angelo Auricchio and Antonietta Mira for their supervision. Alessio Quaglino and Jost Reinhold for their help in implementing the first implementation of this problem in lpSolve. Martin Weiser for his suggestion for the relocation process. Matt Sutton for his very thoughtful explanations on how to interact with high level solvers, which led to implementing maxcovr in lpsolve, glpk, and gurobi. And Alex Simmons, for teaching me how to write better C++ code.</p>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/njtierney/maxcovr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/njtierney/maxcovr/issues" class="external-link">Report a bug</a></li>
<li><a href="https://github.com/njtierney/maxcovr" class="external-link">Learn more</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
<li><a href="SUPPORT.html">Getting help</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing maxcovr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Nicholas Tierney <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/https://orcid.org/0000-0003-1460-8722" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Mark Padgham <br><small class="roles"> Author </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/njtierney/maxcovr/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/njtierney/maxcovr/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/njtierney/maxcovr" class="external-link"><img src="https://codecov.io/gh/njtierney/maxcovr/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nicholas Tierney, Mark Padgham.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
