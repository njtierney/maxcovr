<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using Cross Validation with maxcovr • maxcovr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using Cross Validation with maxcovr">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">maxcovr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3.9200</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/cross_validation_with_maxcovr.html">Using Cross Validation with maxcovr</a></li>
    <li><a class="dropdown-item" href="../articles/intro_to_maxcovr.html">Using maxcovr</a></li>
    <li><a class="dropdown-item" href="../articles/using_max_coverage_relocation.html">Using max_coverage_relocation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/njtierney/maxcovr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using Cross Validation with maxcovr</h1>
                        <h4 data-toc-skip class="author">Nicholas
Tierney</h4>
            
            <h4 data-toc-skip class="date">2024-11-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/njtierney/maxcovr/blob/master/vignettes/cross_validation_with_maxcovr.Rmd" class="external-link"><code>vignettes/cross_validation_with_maxcovr.Rmd</code></a></small>
      <div class="d-none name"><code>cross_validation_with_maxcovr.Rmd</code></div>
    </div>

    
    
<p>This vignette provides a guide to performing cross validation with
modelr and maxcovr. Cross validation is a bit of a strange concept in
this context - we aren’t trying to make predictions here, but what we
are trying to do is appropriately evaluate the performance of maxcovr in
a fairer way.</p>
<p>In the future if this is a feature that is under demand, I will
incorporate cross validation into maxcovr. In the mean time, here’s a
vignette.</p>
<div class="section level2">
<h2 id="performing-cross-validation-on-max_coverage">Performing cross validation on max_coverage<a class="anchor" aria-label="anchor" href="#performing-cross-validation-on-max_coverage"></a>
</h2>
<p>We will stick with the previous example using york and york_crime</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/njtierney/maxcovr" class="external-link">maxcovr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dplyr'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter, lag</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     intersect, setdiff, setequal, union</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># subset to be the places with towers built on them.</span></span>
<span><span class="va">york_selected</span> <span class="op">&lt;-</span> <span class="va">york</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">grade</span> <span class="op">==</span> <span class="st">"I"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">york_unselected</span> <span class="op">&lt;-</span> <span class="va">york</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">grade</span> <span class="op">!=</span> <span class="st">"I"</span><span class="op">)</span></span></code></pre></div>
<p>Thanks to the <code>modelr</code> package, it is relatively
straightforward to perform cross validation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first we partition the data into 5 folds</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modelr.tidyverse.org" class="external-link">modelr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="va">mc_cv</span> <span class="op">&lt;-</span> <span class="fu">modelr</span><span class="fu">::</span><span class="fu"><a href="https://modelr.tidyverse.org/reference/crossv_mc.html" class="external-link">crossv_kfold</a></span><span class="op">(</span><span class="va">york_crime</span>, <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="co"># we change the test and train sets from the `resample`</span></span>
<span>    <span class="co"># to tibbles</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>test <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">test</span>,<span class="va">as_tibble</span><span class="op">)</span>,</span>
<span>           train <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">train</span>,<span class="va">as_tibble</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This creates a dataframe with test and training sets</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mc_cv</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 5 × 3</span></span></span>
<span><span class="co">##   train                 test                .id  </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;named list&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;named list&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> <span style="color: #949494;">&lt;tibble [1,451 × 12]&gt;</span> <span style="color: #949494;">&lt;tibble [363 × 12]&gt;</span> 1    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> <span style="color: #949494;">&lt;tibble [1,451 × 12]&gt;</span> <span style="color: #949494;">&lt;tibble [363 × 12]&gt;</span> 2    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> <span style="color: #949494;">&lt;tibble [1,451 × 12]&gt;</span> <span style="color: #949494;">&lt;tibble [363 × 12]&gt;</span> 3    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> <span style="color: #949494;">&lt;tibble [1,451 × 12]&gt;</span> <span style="color: #949494;">&lt;tibble [363 × 12]&gt;</span> 4    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> <span style="color: #949494;">&lt;tibble [1,452 × 12]&gt;</span> <span style="color: #949494;">&lt;tibble [362 × 12]&gt;</span> 5</span></span></code></pre>
<p>We then fit the model on the training set using <code>map_df</code>,
from the <code>purrr</code> package.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="co"># then we fit the model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>    <span class="va">mc_cv_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="va">mc_cv</span><span class="op">$</span><span class="va">train</span>,</span>
<span>                     <span class="op">~</span><span class="fu"><a href="../reference/max_coverage.html">max_coverage</a></span><span class="op">(</span>existing_facility <span class="op">=</span> <span class="va">york_selected</span>,</span>
<span>                                   proposed_facility <span class="op">=</span> <span class="va">york_unselected</span>,</span>
<span>                                   user <span class="op">=</span> <span class="va">.</span>, <span class="co"># training set goes here</span></span>
<span>                                   n_added <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                   distance_cutoff <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##   2.721   0.035   2.756</span></span></code></pre>
<p>Then we can use the <code>summary_mc_cv</code> function to extract
out the summaries from each fold. This summary takes the facilities
placed using the training set of users, and then takes the test set of
users and counts what percent of these are being covered by the training
model.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summarised_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summary_mc_cv.html">summary_mc_cv</a></span><span class="op">(</span><span class="va">mc_cv_fit</span>, <span class="va">mc_cv</span><span class="op">)</span></span>
<span></span>
<span><span class="va">summarised_cv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="9%">
<col width="8%">
<col width="18%">
<col width="6%">
<col width="11%">
<col width="11%">
<col width="13%">
<col width="10%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="right">n_added</th>
<th align="left">n_fold</th>
<th align="right">distance_within</th>
<th align="right">n_cov</th>
<th align="right">pct_cov</th>
<th align="right">n_not_cov</th>
<th align="right">pct_not_cov</th>
<th align="right">dist_avg</th>
<th align="right">dist_sd</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">20</td>
<td align="left">1</td>
<td align="right">100</td>
<td align="right">40</td>
<td align="right">0.1101928</td>
<td align="right">323</td>
<td align="right">0.8898072</td>
<td align="right">1182.781</td>
<td align="right">1592.740</td>
</tr>
<tr class="even">
<td align="right">20</td>
<td align="left">2</td>
<td align="right">100</td>
<td align="right">47</td>
<td align="right">0.1294766</td>
<td align="right">316</td>
<td align="right">0.8705234</td>
<td align="right">1218.770</td>
<td align="right">1552.598</td>
</tr>
<tr class="odd">
<td align="right">20</td>
<td align="left">3</td>
<td align="right">100</td>
<td align="right">57</td>
<td align="right">0.1570248</td>
<td align="right">306</td>
<td align="right">0.8429752</td>
<td align="right">1013.072</td>
<td align="right">1334.441</td>
</tr>
<tr class="even">
<td align="right">20</td>
<td align="left">4</td>
<td align="right">100</td>
<td align="right">40</td>
<td align="right">0.1101928</td>
<td align="right">323</td>
<td align="right">0.8898072</td>
<td align="right">1353.579</td>
<td align="right">1695.712</td>
</tr>
<tr class="odd">
<td align="right">20</td>
<td align="left">5</td>
<td align="right">100</td>
<td align="right">50</td>
<td align="right">0.1381215</td>
<td align="right">312</td>
<td align="right">0.8618785</td>
<td align="right">1011.945</td>
<td align="right">1346.483</td>
</tr>
</tbody>
</table>
<p>Eyeballing the values, it looks like the pct coverage stays around
10%, but we can plot it to get a better idea. We can overlay the
coverage obtained using the full dataset to get an idea of how we are
performing.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">summarised_cv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n_fold</span>,</span>
<span>               y <span class="op">=</span> <span class="va">pct_cov</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="cross_validation_with_maxcovr_files/figure-html/plot-summarised-cv-1.png" width="700"></p>
<p>Here we see that the pct_coverage doesn’t seem to change much across
the folds.</p>
<p>Coming up next, we will explore how to perform cross validation as we
increase the number of facilities added.</p>
<p>Ideally, there should be a way to do this using purrr, so we don’t
have to fic 5 separate models, but perhaps this will change when we
enable n_added to take a vector of values.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># then we fit the model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>    <span class="va">mc_cv_fit_n20</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="va">mc_cv</span><span class="op">$</span><span class="va">train</span>,</span>
<span>                     <span class="op">~</span><span class="fu"><a href="../reference/max_coverage.html">max_coverage</a></span><span class="op">(</span>existing_facility <span class="op">=</span> <span class="va">york_selected</span>,</span>
<span>                                   proposed_facility <span class="op">=</span> <span class="va">york_unselected</span>,</span>
<span>                                   user <span class="op">=</span> <span class="va">.</span>, <span class="co"># training set goes here</span></span>
<span>                                   n_added <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                   distance_cutoff <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##   2.365   0.024   2.389</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>    <span class="va">mc_cv_fit_n40</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="va">mc_cv</span><span class="op">$</span><span class="va">train</span>,</span>
<span>                     <span class="op">~</span><span class="fu"><a href="../reference/max_coverage.html">max_coverage</a></span><span class="op">(</span>existing_facility <span class="op">=</span> <span class="va">york_selected</span>,</span>
<span>                                   proposed_facility <span class="op">=</span> <span class="va">york_unselected</span>,</span>
<span>                                   user <span class="op">=</span> <span class="va">.</span>, <span class="co"># training set goes here</span></span>
<span>                                   n_added <span class="op">=</span> <span class="fl">40</span>,</span>
<span>                                   distance_cutoff <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##   2.324   0.004   2.328</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>    <span class="va">mc_cv_fit_n60</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="va">mc_cv</span><span class="op">$</span><span class="va">train</span>,</span>
<span>                     <span class="op">~</span><span class="fu"><a href="../reference/max_coverage.html">max_coverage</a></span><span class="op">(</span>existing_facility <span class="op">=</span> <span class="va">york_selected</span>,</span>
<span>                                   proposed_facility <span class="op">=</span> <span class="va">york_unselected</span>,</span>
<span>                                   user <span class="op">=</span> <span class="va">.</span>, <span class="co"># training set goes here</span></span>
<span>                                   n_added <span class="op">=</span> <span class="fl">60</span>,</span>
<span>                                   distance_cutoff <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##   2.433   0.004   2.437</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>    <span class="va">mc_cv_fit_n80</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="va">mc_cv</span><span class="op">$</span><span class="va">train</span>,</span>
<span>                     <span class="op">~</span><span class="fu"><a href="../reference/max_coverage.html">max_coverage</a></span><span class="op">(</span>existing_facility <span class="op">=</span> <span class="va">york_selected</span>,</span>
<span>                                   proposed_facility <span class="op">=</span> <span class="va">york_unselected</span>,</span>
<span>                                   user <span class="op">=</span> <span class="va">.</span>, <span class="co"># training set goes here</span></span>
<span>                                   n_added <span class="op">=</span> <span class="fl">80</span>,</span>
<span>                                   distance_cutoff <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##   2.460   0.008   2.468</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>    <span class="va">mc_cv_fit_n100</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="va">mc_cv</span><span class="op">$</span><span class="va">train</span>,</span>
<span>                     <span class="op">~</span><span class="fu"><a href="../reference/max_coverage.html">max_coverage</a></span><span class="op">(</span>existing_facility <span class="op">=</span> <span class="va">york_selected</span>,</span>
<span>                                   proposed_facility <span class="op">=</span> <span class="va">york_unselected</span>,</span>
<span>                                   user <span class="op">=</span> <span class="va">.</span>, <span class="co"># training set goes here</span></span>
<span>                                   n_added <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                                   distance_cutoff <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##  13.356   0.028  13.384</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summarised_cv_n20</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summary_mc_cv.html">summary_mc_cv</a></span><span class="op">(</span><span class="va">mc_cv_fit_n20</span>, <span class="va">mc_cv</span><span class="op">)</span></span>
<span><span class="va">summarised_cv_n40</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summary_mc_cv.html">summary_mc_cv</a></span><span class="op">(</span><span class="va">mc_cv_fit_n40</span>, <span class="va">mc_cv</span><span class="op">)</span></span>
<span><span class="va">summarised_cv_n60</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summary_mc_cv.html">summary_mc_cv</a></span><span class="op">(</span><span class="va">mc_cv_fit_n60</span>, <span class="va">mc_cv</span><span class="op">)</span></span>
<span><span class="va">summarised_cv_n80</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summary_mc_cv.html">summary_mc_cv</a></span><span class="op">(</span><span class="va">mc_cv_fit_n80</span>, <span class="va">mc_cv</span><span class="op">)</span></span>
<span><span class="va">summarised_cv_n100</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summary_mc_cv.html">summary_mc_cv</a></span><span class="op">(</span><span class="va">mc_cv_fit_n100</span>, <span class="va">mc_cv</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bound_testing_summaries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">summarised_cv_n20</span>,</span>
<span>                                     <span class="va">summarised_cv_n40</span>,</span>
<span>                                     <span class="va">summarised_cv_n60</span>,</span>
<span>                                     <span class="va">summarised_cv_n80</span>,</span>
<span>                                     <span class="va">summarised_cv_n100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"test"</span><span class="op">)</span></span></code></pre></div>
<p>It looks like the more facilities we add, the better the
coverage…mostly.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bound_training_summaries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">mc_cv_fit_n20</span><span class="op">$</span><span class="va">model_coverage</span>,</span>
<span>                                      <span class="va">mc_cv_fit_n40</span><span class="op">$</span><span class="va">model_coverage</span>,</span>
<span>                                      <span class="va">mc_cv_fit_n60</span><span class="op">$</span><span class="va">model_coverage</span>,</span>
<span>                                      <span class="va">mc_cv_fit_n80</span><span class="op">$</span><span class="va">model_coverage</span>,</span>
<span>                                      <span class="va">mc_cv_fit_n100</span><span class="op">$</span><span class="va">model_coverage</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"training"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bound_all_summaries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">bound_testing_summaries</span>,</span>
<span>                                 <span class="va">bound_training_summaries</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">bound_testing_summaries</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n_fold</span>,</span>
<span>               y <span class="op">=</span> <span class="va">pct_cov</span>,</span>
<span>               colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">n_added</span><span class="op">)</span>,</span>
<span>               group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">n_added</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="cross_validation_with_maxcovr_files/figure-html/plot-testing-summaries-1.png" width="700"></p>
<p>Let’s look at this another way, with boxplots for the number of
facilities added.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">bound_testing_summaries</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">n_added</span><span class="op">)</span>,</span>
<span>           y <span class="op">=</span> <span class="va">n_cov</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="cross_validation_with_maxcovr_files/figure-html/plot-ncov-1.png" width="700"></p>
<p>We can also compare the % coverage for the test and training
datasets</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bound_all_summaries</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">n_added</span><span class="op">)</span>,</span>
<span>               y <span class="op">=</span> <span class="va">pct_cov</span>,</span>
<span>               fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="cross_validation_with_maxcovr_files/figure-html/plot-all-summaries-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nicholas Tierney, Mark Padgham.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
